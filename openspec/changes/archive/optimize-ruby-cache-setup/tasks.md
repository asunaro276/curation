# 実装タスク: Ruby依存関係キャッシュの最適化

## 1. 現状調査と設計
- [ ] 1.1 現在の `.github/workflows/run-curation.yml` のRuby設定を確認
- [ ] 1.2 `bundler-cache: true` の動作を理解
- [ ] 1.3 actions/cache を使用した明示的なキャッシュ設定を設計
- [ ] 1.4 キャッシュキーの形式を決定（OS + Rubyバージョン + Gemfile.lockハッシュ）

## 2. ワークフロー設定の更新
- [ ] 2.1 `.github/workflows/run-curation.yml` にキャッシュ復元ステップを追加
- [ ] 2.2 キャッシュキーを設定（`${{ runner.os }}-ruby-${{ hashFiles('**/Gemfile.lock') }}`）
- [ ] 2.3 復元キーの設定（部分一致のフォールバック）
- [ ] 2.4 キャッシュパス（vendor/bundle）を設定
- [ ] 2.5 Ruby setup ステップで `bundler-cache: true` を維持または削除（設計に応じて）
- [ ] 2.6 bundle config で install 先を vendor/bundle に設定

## 3. キャッシュ可視化の実装
- [ ] 3.1 キャッシュヒット時のログ出力を追加
- [ ] 3.2 キャッシュミス時のログ出力を追加
- [ ] 3.3 bundle install 実行時間の測定ステップを追加（オプション）

## 4. テストと検証（並列実行可能）
- [ ] 4.1 ワークフローのYAML構文を検証
- [ ] 4.2 手動トリガーでワークフローを実行（初回：キャッシュミス）
- [ ] 4.3 Gemfile.lock を変更せずに再実行（キャッシュヒット確認）
- [ ] 4.4 ワークフローログでキャッシュヒット/ミスを確認
- [ ] 4.5 既存の機能（記事収集、要約、投稿）が正常に動作することを確認

## 5. ドキュメント更新
- [ ] 5.1 CLAUDE.md のGitHub Actionsセクションにキャッシュ設定を追加
- [ ] 5.2 キャッシュの動作原理を説明
- [ ] 5.3 キャッシュのトラブルシューティング情報を追加

## 6. コミットとプッシュ
- [ ] 6.1 変更をコミット（メッセージ: "Ruby依存関係キャッシュを最適化"）
- [ ] 6.2 ブランチにプッシュ

## 検証方法
1. **キャッシュミスの確認**
   - 初回実行または Gemfile.lock 変更後にワークフロー実行
   - ログに "Cache not found" が表示されることを確認
   - bundle install が完全に実行されることを確認

2. **キャッシュヒットの確認**
   - Gemfile.lock を変更せずにワークフロー再実行
   - ログに "Cache restored from key" が表示されることを確認
   - bundle install が高速化されることを確認

3. **実行時間の比較**
   - キャッシュミス時の実行時間を記録
   - キャッシュヒット時の実行時間を記録
   - 短縮効果を測定

4. **機能の正常性確認**
   - 技術ニュースの収集が正常に動作
   - Claude APIによる要約が正常に動作
   - Slack/LINE投稿が正常に動作

## 依存関係と並列化
- タスク1は最初に完了する必要あり
- タスク2はタスク1の完了後に実行
- タスク3はタスク2と並行して実行可能
- タスク4はタスク2, 3の完了後に実行
- タスク5はタスク4と並行して実行可能
- タスク6は全タスク完了後に実行
