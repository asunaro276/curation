# Proposal: 要約出力形式のカスタマイズ

## 概要

記事要約時のプロンプトと出力形式を、事前定義されたテンプレートから選択できるようにする機能を追加します。

## 背景

現在、Summarizer (`lib/tech_news/summarizer.rb`) では要約プロンプトと出力形式がハードコードされています：

```ruby
def build_prompt(article, content)
  <<~PROMPT
    あなたは技術ニュースのキュレーターです。
    以下の記事を日本語で要約してください。
    ...
    以下の形式で出力してください:
    1. 2-3文の簡潔な要約
    2. 重要なポイント（箇条書き、最大3点）
  PROMPT
end
```

この実装では以下の課題があります：

- **柔軟性の欠如**: 異なる要約スタイル（簡潔版、詳細版、技術特化版など）が必要な場合にコード変更が必要
- **設定の分散**: 他の設定は `config/sources.yml` で管理されているが、要約スタイルだけがコード内に埋め込まれている
- **実験の困難さ**: プロンプトを試行錯誤する際、毎回コード編集とテスト実行が必要

## 目標

1. **テンプレート選択機能**: `config/sources.yml` で要約テンプレートを選択可能にする
2. **事前定義テンプレート**: 一般的な用途に対応する複数のテンプレートを提供
3. **後方互換性**: デフォルトで現在の動作を維持（既存の設定ファイルでも動作）

## スコープ

### 対象

- `TechNews::Summarizer` クラスのプロンプト生成ロジック
- `config/sources.yml` への設定項目追加
- テンプレート定義の管理構造

### 対象外（今回は含まない）

- Slack通知フォーマットのカスタマイズ
- カスタムテンプレートの動的追加（ユーザー定義テンプレート）
- テンプレートの複数言語対応

## 提案する変更

### 1. 設定ファイル拡張

`config/sources.yml` に新しい設定セクションを追加：

```yaml
# 要約設定
summarization:
  # 使用するテンプレート (default, concise, detailed, technical, bullet_points)
  template: default
```

### 2. テンプレート定義

以下の事前定義テンプレートを提供：

- **default**: 現在の形式（2-3文の要約 + 最大3点の箇条書き）
- **concise**: 1-2文の超簡潔な要約のみ
- **detailed**: 詳細な要約（4-5文 + 5点程度の箇条書き）
- **technical**: 技術的詳細に特化（アーキテクチャ、技術スタック、パフォーマンスなど）
- **bullet_points**: 箇条書きのみ（5-7点）

### 3. 実装アプローチ

- テンプレート定義は `lib/tech_news/summarizer_templates.rb` に集約
- `Summarizer#build_prompt` でテンプレートを選択して適用
- テンプレートは文字列補間可能なフォーマットで定義

## 影響を受けるCapability

- **content-summarization**: 要約生成の振る舞いが変更される（新しい要件を追加）

## リスクと制約

### リスク

- **出力品質の変動**: テンプレートによってClaude APIからの出力品質が変わる可能性
- **トークン消費**: 詳細テンプレートを使用するとトークン消費量が増加

### 制約

- Claude APIのトークン制限内でテンプレートを設計する必要がある
- すべてのテンプレートは日本語出力を前提とする

## 成功基準

1. ✅ `config/sources.yml` でテンプレートを指定できる
2. ✅ 5種類の事前定義テンプレートが利用可能
3. ✅ デフォルト設定（テンプレート未指定）で既存の動作を維持
4. ✅ すべてのテンプレートで正常に要約が生成される
5. ✅ 既存のテストが引き続きパスする

## 代替案

### 代替案1: 完全カスタムプロンプト

`sources.yml` に直接プロンプトテキストを記述できるようにする。

**却下理由**:
- YAML内に長文プロンプトを記述すると可読性が低下
- 初心者にはテンプレート選択の方が使いやすい
- 将来的な拡張として検討可能（Phase 2）

### 代替案2: 環境変数での指定

`SUMMARIZATION_TEMPLATE` 環境変数で指定する。

**却下理由**:
- 他の設定が `sources.yml` にある中で一貫性がない
- 複数のソースで異なるテンプレートを使いたい場合に対応できない

## 次のステップ

1. この提案をレビュー・承認
2. `tasks.md` で実装タスクを詳細化
3. `specs/summarization-templates/spec.md` で要件を定義
4. 実装とテスト
5. ドキュメント更新
